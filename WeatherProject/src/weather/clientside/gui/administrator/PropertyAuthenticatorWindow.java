package weather.clientside.gui.administrator;

import weather.ApplicationControlSystem;
import weather.common.data.UserType;
import weather.common.gui.component.BUDialog;

/**
 * This window will pop up when someone tries to edit or delete a property from
 * the database property manager window. This is to prevent someone from getting
 * access to the database and able to modify it.
 *
 * @author Colton Daily (2014)
 * @version Spring 2014
 */
public class PropertyAuthenticatorWindow extends BUDialog {

    private ApplicationControlSystem appControl;
    private boolean isAdmin;

    public PropertyAuthenticatorWindow(ApplicationControlSystem appControl) {
        super(appControl);
        this.appControl = appControl;
        isAdmin = false;
        initComponents();
        super.postInitialize(false);
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        usernameLabel = new javax.swing.JLabel();
        passwordLabel = new javax.swing.JLabel();
        usernameTextField = new javax.swing.JTextField();
        authenticateButton = new javax.swing.JButton();
        closeButton = new javax.swing.JButton();
        descriptionLabel = new javax.swing.JLabel();
        passwordTextField = new javax.swing.JPasswordField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Authenticate");
        setName("propertyAuthenticaterWindow"); // NOI18N
        setResizable(false);

        usernameLabel.setText("Username:");

        passwordLabel.setText("Password:");

        authenticateButton.setText("Authenticate");
        authenticateButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                authenticateButtonActionPerformed(evt);
            }
        });

        closeButton.setText("Close");
        closeButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeButtonActionPerformed(evt);
            }
        });

        descriptionLabel.setText("Enter your username and password to proceed");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addGroup(layout.createSequentialGroup()
                            .addComponent(authenticateButton)
                            .addGap(18, 18, 18)
                            .addComponent(closeButton))
                        .addGroup(layout.createSequentialGroup()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(usernameLabel)
                                .addComponent(passwordLabel))
                            .addGap(18, 18, 18)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                .addComponent(usernameTextField)
                                .addComponent(passwordTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 150, Short.MAX_VALUE))))
                    .addComponent(descriptionLabel))
                .addContainerGap(19, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(descriptionLabel)
                .addGap(13, 13, 13)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(usernameLabel)
                    .addComponent(usernameTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(passwordLabel)
                    .addComponent(passwordTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 26, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(authenticateButton)
                    .addComponent(closeButton))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    public boolean getIsAdmin()
    {
        return isAdmin;
    }
    /**
     * Authenticates the user and gives them access to the property. Based on
     * the login method from the LoginWindow class.
     *
     * @param evt
     */
    private void authenticateButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_authenticateButtonActionPerformed
        if (usernameTextField.getText().trim().isEmpty()
                || new String(passwordTextField.getPassword()).trim().isEmpty()) {
            descriptionLabel.setText("No username or password"
                    + " entered. Please try again.");
            //copied from generated code
            descriptionLabel.setFont(new java.awt.Font("Tahoma", 2, 11)); // NOI18N
            descriptionLabel.setForeground(new java.awt.Color(255, 0, 0));
        } else {
            String username = usernameTextField.getText().trim();
            String password = new String(passwordTextField.getPassword()).trim();
            if (appControl.getGeneralService().validateUserAndUpdateLoginInformation(username, password)) {
                //if administrator
                if (appControl.getGeneralService().getUser().getUserType() == UserType.administrator) {
                    isAdmin = true;
                    dispose();
                    //TODO: add code to handle the property
                } else {
                    //if not administrator
                    usernameTextField.setText("");
                    passwordTextField.setText("");
                    descriptionLabel.setText("User does not have admin rights.");
                    //copied from generated code
                    descriptionLabel.setFont(new java.awt.Font("Tahoma", 2, 11)); // NOI18N
                    descriptionLabel.setForeground(new java.awt.Color(255, 0, 0));
                    usernameTextField.requestFocus();
                }
            } else {
                passwordTextField.setText("");
                descriptionLabel.setText("Invalid login information"
                        + ". Please try again.");
                //copied from generated code
                descriptionLabel.setFont(new java.awt.Font("Tahoma", 2, 11)); // NOI18N
                descriptionLabel.setForeground(new java.awt.Color(255, 0, 0));
                passwordTextField.requestFocus();
            }
        }
    }//GEN-LAST:event_authenticateButtonActionPerformed

    private void closeButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeButtonActionPerformed
        dispose();
    }//GEN-LAST:event_closeButtonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton authenticateButton;
    private javax.swing.JButton closeButton;
    private javax.swing.JLabel descriptionLabel;
    private javax.swing.JLabel passwordLabel;
    private javax.swing.JPasswordField passwordTextField;
    private javax.swing.JLabel usernameLabel;
    private javax.swing.JTextField usernameTextField;
    // End of variables declaration//GEN-END:variables
}
